#!/bin/ksh

internal=$(xrandr | grep -w "connected" | awk '{if(NR>0)print $1}' | head -n 1)
external=$(xrandr | grep -w "connected" | awk '{if(NR>1)print $1}' | head -n 1)
internal_active=$(xrandr --listactivemonitors | grep "$internal")

args=""

if [ -z "$internal_active" ]; then
    args="--output $internal --auto --primary"
    [ -n "$external" ] && args="$args --output $external --off"
else
    [ -n "$external" ] && args="--output $external --auto --primary"
    [ -n "$args" ] && args="$args --output $internal --off"
fi

[ -n "$args" ] && {
    pkill conky

    while [ "$(pgrep conky | wc -l)" -ne 0 ]; do
        sleep 0.5
    done

    # shellcheck disable=2086
    xrandr $args
    conky -qd
}
